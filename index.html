<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Glass-Rails by thirst</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Glass-Rails</h1>
        <h2>A DSL for building Google Glass apps using Ruby on Rails. </h2>
        <a href="https://github.com/thirst/glass-rails" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2>Glass-Rails</h2>

<p>This is a ruby gem extracted out of <a href="http://thirst.co/glass">Thirst Droplet</a>, a google glass application. The goal of this gem is to provide a more convenient wrapper around the official <a href="https://github.com/google/google-api-ruby-client">Google Api Client for Ruby</a>. This gem is still quite young, and in development, so keep posted for updates (and we also &lt;3 pull requests). </p>

<h2>Installation</h2>

<p>Add the following to your Gemfile and then run <code>bundle install</code>.</p>

<div class="highlight"><pre><span class="n">gem</span> <span class="s1">'glass-rails'</span>
</pre></div>

<p>Or you can install the gem locally, by running the following command in the terminal:</p>

<pre lang="shell"><code>$ gem install glass-rails
</code></pre>

<h2>Basic Setup</h2>

<p>In order to get this gem setup for use, we require that you have some sort of user model already in place. You can, for example, have a <code>devise</code> generated User model, or a custom hand-rolled user model. </p>

<p>For convenience, this gem provides a command to scaffold some necessary files for glass development:</p>

<pre lang="shell"><code>$ rails g glass:install &lt;optional_name_of_user_model&gt;
                       # defaults to 'User'
</code></pre>

<p>If the name of user model is not <code>User</code> then you must specify this when invoking the <code>glass:install</code> command:</p>

<pre lang="shell"><code>$ rails g glass:install person
</code></pre>

<h3>Files created by the <code>glass:install</code> generator</h3>

<ol>
<li>A <code>config/google-api-keys.yml</code> file for your client_id and client_secret api keys for accessing the mirror api.</li>
<li>A Glass::Rails initializer file in <code>config/initializers/glass.rb</code> for setting up default view paths for your glass templates.</li>
<li>Generates a <code>app/models/google_account.rb</code> model which is automatically associated to your user model.</li>
<li>A controller is created for 'listening' to subscription notifications from your glass users. </li>
</ol><h2>Pre-defined Templates for Glass</h2>

<p>This gem also includes pre-defined erb templates for use with timeline items. You can generate these templates for use by running the following command: </p>

<pre lang="shell"><code>$ rails g glass:templates
</code></pre>

<p>This will generate a name-spaced folder in your <code>app/views</code> directory called <code>glass</code> and populate it with a few useful predefined templates. </p>

<h2>Creating Timeline Items</h2>

<p>This gem also includes a generator for creating an ActiveRecord backed timeline item or a "glass model". </p>

<h2>Glass::TimelineItem (a superclass which you'll be inheriting from)</h2>

<p>The Glass::TimelineItem class is a subclass of ActiveRecord which is, for all intents and purposes, an abstract class. We've basically added a few convenience methods to ActiveRecord which allows for the easy population of custom menu items and some procedures for serializing these items for posting them to the glass timeline. </p>

<h3>The TimelineItem Generator</h3>

<p>You can generate a timeline_item model by executing the following command:</p>

<pre lang="shell"><code>$ rails g glass:model &lt;name of model&gt;
</code></pre>

<p>So, for the sake of illustration, let's say you wanted to generate a tweet model, which you intend to use to post particular tweets to a glass user's timeline. I would, then, execute this command:</p>

<pre lang="shell"><code>$ rails g glass:model tweet
</code></pre>

<p>This would create a model for me in the following directory <code>app/models/glass/tweet.rb</code>. This <code>Glass::Tweet</code> model would inherit from <code>Glass::TimelineItem</code> and would therefore be accompanied by a sugary goodness which makes posting to glass timelines a ton easier. </p>

<h3>Setting up a Glass Model</h3>

<hr><h4>Defining a Default Template</h4>

<p>You may want to specify a default template to use for a given timeline item. For example, if I had two timeline item models, <code>Glass::Tweet</code> and another <code>Glass::BasketballScore</code>, then I could specify a default template for the tweet model to use by using a helper_method in the class definition, like so:</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">Glass</span><span class="o">::</span><span class="no">Tweet</span> <span class="o">&lt;</span> <span class="ss">Glass</span><span class="p">:</span><span class="ss">:TimelineItem</span>
  <span class="n">defaults_template</span> <span class="ss">with</span><span class="p">:</span> <span class="s2">"tweet.html.erb"</span> <span class="c1">## this path is relative to </span>
                                           <span class="c1">## your glass_templates_path, </span>
                                           <span class="c1">## which you can set in your</span>
                                           <span class="c1">## `config/initializers/glass.rb` </span>
                                           <span class="c1">## file.</span>

<span class="k">end</span>
</pre></div>

<p>and then you could define another default template for your basketball score model like so:</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">Glass</span><span class="o">::</span><span class="no">BasketballScore</span> <span class="o">&lt;</span> <span class="ss">Glass</span><span class="p">:</span><span class="ss">:TimelineItem</span>
  <span class="n">defaults_template</span> <span class="ss">with</span><span class="p">:</span> <span class="s2">"two_column.html.erb"</span> <span class="c1">## since this would make</span>
                                                <span class="c1">## sense if wanted to show </span>
                                                <span class="c1">## a score in each column.</span>
<span class="k">end</span>
</pre></div>

<h4>Defining Menu Items on the Timeline Item</h4>

<p>This gem provides some meta-programming magic to ease the creation of both custom and built-in menu-items for glass, by providing an easy to use DSL for specifying custom and built-in menu-items that a timeline-item should have..</p>

<p>For example, let's say I want to have two default actions on my <code>Glass::Tweet</code> object: 1) email this tweet to me. 2) read the tweet to me aloud. </p>

<p>Inside my <code>Glass::Tweet</code> class definition, I would specify these actions like so:</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">Glass</span><span class="o">::</span><span class="no">Tweet</span> <span class="o">&lt;</span> <span class="ss">Glass</span><span class="p">:</span><span class="ss">:TimelineItem</span>
  <span class="n">has_menu_item</span> <span class="ss">:email</span><span class="p">,</span> <span class="n">icon_url</span><span class="p">:</span> <span class="s2">"http://www.example.com/example-email-icon.png"</span><span class="p">,</span>
                        <span class="n">display_name</span><span class="p">:</span> <span class="s2">"Email"</span><span class="p">,</span> <span class="c1"># this is what is shown </span>
                                               <span class="c1"># as text for the menu item</span>
                        <span class="n">handles_with</span><span class="p">:</span> <span class="ss">:email_callback</span> 
                                               <span class="c1"># we'll ignore this for now.</span>
  <span class="n">has_menu_item</span> <span class="ss">:read_aloud</span> <span class="c1">## this is a built-in action.</span>

<span class="k">end</span>
</pre></div>

<p>This would basically define two actions for all items posted with this glass model, i.e. Email &amp; Read Aloud.</p>

<p>You can define a different set of menu items for each model, so that would probably be something to consider when architecting your glass app. </p>

<h2>Inserting a Timeline Item to Glass</h2>

<p>For the sake of simplicity, let's continue with the example we've been using so far, the <code>Glass::Tweet</code> model. If we had a hypothetical tweet:</p>

<div class="highlight"><pre><span class="vi">@tweet</span> <span class="o">=</span> <span class="p">{</span> 
  <span class="ss">content</span><span class="p">:</span> <span class="s2">"Rails is omakase"</span><span class="p">,</span> 
  <span class="ss">author</span><span class="p">:</span> <span class="s2">"@dhh"</span> 
<span class="p">}</span>
</pre></div>

<p>If we wanted to post it to a glass user's timeline, we would first initialize a <code>Glass::Tweet</code> object and associate it to the google account that we want to send this tweet.</p>

<div class="highlight"><pre><span class="vi">@tweet_timeline_object</span> <span class="o">=</span> <span class="ss">Glass</span><span class="p">:</span><span class="ss">:Tweet</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">google_account_id</span><span class="p">:</span> <span class="no">GoogleAccount</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>

<p>Then, we can serialize our html for posting by executing this command:</p>

<div class="highlight"><pre><span class="vi">@tweet_timeline_object</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">template_variables</span><span class="p">:</span> <span class="p">{</span><span class="n">tweet_content</span><span class="p">:</span> <span class="vi">@tweet</span><span class="o">[</span><span class="ss">:content</span><span class="o">]</span><span class="p">,</span> 
                                                      <span class="ss">author</span><span class="p">:</span> <span class="vi">@tweet</span><span class="o">[</span><span class="ss">:author</span><span class="o">]</span><span class="p">})</span>

<span class="c1">### if you pass in a key named "template_name" </span>
<span class="c1">### into the single argument that `serialize`</span>
<span class="c1">### takes as a method, then you can also </span>
<span class="c1">### override the default template rendered for </span>
<span class="c1">### instances of this class.</span>

<span class="c1">### For example:</span>
<span class="vi">@tweet_timeline_object</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">template_variables</span><span class="p">:</span> <span class="p">{</span><span class="n">tweet_content</span><span class="p">:</span> <span class="vi">@tweet</span><span class="o">[</span><span class="ss">:content</span><span class="o">]</span><span class="p">,</span> 
                                                      <span class="ss">author</span><span class="p">:</span> <span class="vi">@tweet</span><span class="o">[</span><span class="ss">:author</span><span class="o">]</span><span class="p">},</span>
                                 <span class="n">template_name</span><span class="p">:</span> <span class="s2">"dramatic-tweet.html.erb"</span><span class="p">)</span>
<span class="c1">### will render this tweet into the template located </span>
<span class="c1">### in `app/views/glass/dramatic-tweet.html.erb` </span>
<span class="c1">### provided you haven't overridden glass_templates_path</span>
<span class="c1">### in your glass initializer.</span>
</pre></div>

<h2>How <code>Serialize</code> connects with our Glass Template</h2>

<p>When we invoke the <code>serialize</code> method on glass timeline item object, we will populate your template, which should be
either the default template for your timeline item class or a manually specified template in the serialize method, with instance variables, each of which correspond to key-value pairs contained within <code>template_variables</code>. </p>

<p>So for our example above, this would mean:</p>

<div class="highlight"><pre><span class="c1">### since we passed this hash:</span>
<span class="c1">### {template_variables: {tweet_content: "Rails is omakase",</span>
<span class="c1">###                       author: "@dhh"}}</span>
<span class="c1">### we will populate our template with the following variables:</span>

<span class="vi">@tweet_content</span> <span class="o">=</span> <span class="s2">"Rails is omakase"</span>
<span class="vi">@author</span> <span class="o">=</span> <span class="s2">"@dhh"</span>
<span class="c1">### note: the values passed into the serialize method </span>
<span class="c1">###       do not have to be simple data types, they</span>
<span class="c1">###       can be full-fledged objects too.</span>
</pre></div>

<p>so given an erb template that looks like this:</p>

<div class="highlight"><pre><span class="x">&lt;article&gt;</span>
<span class="x">  &lt;section&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@tweet_content</span> <span class="cp">%&gt;</span><span class="x">&lt;/section&gt;</span>
<span class="x">  &lt;footer&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@author</span> <span class="cp">%&gt;</span><span class="x">&lt;/footer&gt;</span>
<span class="x">&lt;/article&gt;</span>
</pre></div>

<p>We would be creating a html serialization of your data, which 
would look like this:</p>

<div class="highlight"><pre><span class="nt">&lt;article&gt;</span>
  <span class="nt">&lt;section&gt;</span>Rails is omakase<span class="nt">&lt;/section&gt;</span>
  <span class="nt">&lt;footer&gt;</span>@dhh<span class="nt">&lt;/footer&gt;</span>
<span class="nt">&lt;/article&gt;</span>
</pre></div>

<p>Note: If you want to inspect that your html is getting serialized properly, you can inspect the html yourself by calling to_json on your timeline_item object. This will return a ruby hash which has the html serialization as well as the array of menu items which you intend to post with your timeline item.</p>

<p>And finally, to post to our timeline, we can call this command:</p>

<div class="highlight"><pre><span class="vi">@tweet_timeline_object</span><span class="o">.</span><span class="n">insert</span><span class="p">()</span>
</pre></div>

<hr><h3>Subscriptions / Notifications</h3>

<p>The mirror api lets you subscribe to notifications on Timeline Items. For each user you want to subscribe to notifications for, you must register a callback url with that user's credentials. When a user does an action (delete, custom action, reply, etc.) on a timeline item, Google will post back to that callback url.</p>

<p>A subscription to Google has 5 main parts</p>

<ul>
<li>callbackUrl: Note that this must be HTTPS, so it won't work in development mode.</li>
<li>collection: This can be 'timeline' or 'location'</li>
<li>verifyToken: This is optional, but lets you verify that the request came from Google. Out of the box, we have set GoogleAccounts to have a randomly generated field called verification_secret that we automatically set as the verifyToken</li>
<li>userToken: This is an optional string that Google will always pass back for a particular user. We have set this to be GoogleAccount.id</li>
<li>operations: A list of action types (Insert, Update, Delete) you would want to be notified about</li>
</ul><p>Subscriptions was probably the hardest part to test, but we've included some tools that should make it easier to deal with them.</p>

<p>A GoogleAccount, on creation, will subscribe to the Google callback service with the route glass_notifications_callback_url, which we've defined in the Glass installer. The Glass Notifications controller will then handle Google's post and call the appropriate methods within the TimelineItem.</p>

<p>For example, if a glass user activates the menu-item <code>email</code>, then our glass app would get pinged on our subscription notification callback url. From here, we've implemented a callback handler which allows you to easily manipulate any callback logic, in the comfort of your timeline item model. </p>

<div class="highlight"><pre>  <span class="n">has_menu_item</span> <span class="ss">:email</span><span class="p">,</span>
       <span class="n">icon_url</span><span class="p">:</span> <span class="s2">"http://example.com/test.jpg"</span>
       <span class="n">display_name</span><span class="p">:</span> <span class="s2">"Email This!"</span>
       <span class="n">handles_with</span><span class="p">:</span> <span class="ss">:email_callback_method</span>

  <span class="k">def</span> <span class="nf">email_callback_method</span>
    <span class="c1"># Email this timeline item content to someone</span>
  <span class="k">end</span>
</pre></div>

<p>The method <code>email_callback_method</code> gets executed whenever your subscription notification callback url is pinged with the corresponding menu-item event. </p>

<p>You can also add Google's built in menu items:</p>

<div class="highlight"><pre>  <span class="n">has_menu_item</span> <span class="ss">:read_aloud</span>
</pre></div>

<p>Note that most of the built in timeline actions (but not all) do not trigger callbacks from Google. Exceptions include reply, delete, and share.</p>

<hr><h3>Plans for the Future</h3>

<p>This framework is still young and being actively developed. We &lt;3 bug reports and pull requests.</p>

<h3>To-dos</h3>

<ol>
<li>Work out a wrapper for the mirror location api</li>
<li>Handle all built-in menu-items properly</li>
<li>Figure something out for attachments</li>
</ol><h2>Copyright / License</h2>

<pre><code>Copyright (c) 2013 Thirst Labs, Inc.

MIT License

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</code></pre>

<h6>Authors:</h6>

<h6>Kunal Modi &amp; Han Kang</h6>

<h6>(of Thirst Labs, Inc.)</h6>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/thirst/glass-rails/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/thirst/glass-rails/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/thirst/glass-rails"></a> is maintained by <a href="https://github.com/thirst">thirst</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-41071469-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>